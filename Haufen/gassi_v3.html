<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêï Gassi-Tracker Ultimate</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #ff6b6b;
            --secondary: #4ecdc4;
            --accent: #ffe66d;
            --dark: #2d3436;
            --light: #dfe6e9;
            --glass: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --paw: 'üêæ';
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animierte Hintergrund-Pfoten */
        body::before {
            content: '';
            position: fixed;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(78, 205, 196, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 230, 109, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .paw-print {
            position: fixed;
            font-size: 2rem;
            opacity: 0.1;
            animation: pawWalk 15s linear infinite;
            pointer-events: none;
        }

        @keyframes pawWalk {
            0% { transform: translateX(-100px) rotate(0deg); }
            100% { transform: translateX(calc(100vw + 100px)) rotate(360deg); }
        }

        /* Hauptcontainer */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 30px;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .header h1 {
            color: white;
            font-size: 3rem;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 2px solid var(--accent);
            border-radius: 50px;
            padding: 15px 30px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--accent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .nav-tab:hover::before {
            width: 300px;
            height: 300px;
        }

        .nav-tab:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            color: var(--dark);
        }

        .nav-tab.active {
            background: var(--accent);
            color: var(--dark);
            transform: scale(1.1);
        }

        .nav-tab span {
            position: relative;
            z-index: 1;
        }

        /* Content Panels */
        .content-panel {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .content-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Kategorie Container */
        .category-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .category-container {
                grid-template-columns: 1fr;
            }
        }

        .sub-panel {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.18);
            position: relative;
            overflow: hidden;
        }

        .sub-panel::after {
            content: 'üêï';
            position: absolute;
            bottom: -20px;
            right: -20px;
            font-size: 100px;
            opacity: 0.1;
            transform: rotate(-15deg);
        }

        .sub-panel h3 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Form Elemente */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: white;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid var(--secondary);
            background: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(255, 230, 109, 0.5);
            transform: scale(1.02);
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin: 5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.5s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--accent), var(--primary));
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        /* Key-Value Liste */
        .kv-list {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .kv-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .kv-item:hover {
            transform: translateX(10px);
            box-shadow: -5px 5px 10px rgba(0,0,0,0.2);
        }

        .kv-key {
            font-weight: bold;
            color: var(--dark);
        }

        .kv-value {
            color: #555;
        }

        /* Gassi Runde Panel */
        .gassi-panel {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 3px solid var(--accent);
            margin-top: 30px;
        }

        .timer-display {
            font-size: 4rem;
            color: var(--accent);
            text-align: center;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        /* Slider Styles */
        .slider-container {
            margin: 20px 0;
        }

        .slider {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(to right, #8bc34a 0%, #ffeb3b 50%, #f44336 100%);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .slider-value {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin-top: 10px;
        }

        /* Map Container */
        #map {
            height: 400px;
            border-radius: 15px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* Metric Input */
        .metric-input {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .metric-input input {
            flex: 1;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Animierte Pfoten im Hintergrund -->
    <div class="paw-print" style="top: 10%; left: 0;">üêæ</div>
    <div class="paw-print" style="top: 30%; left: 0; animation-delay: 3s;">üêæ</div>
    <div class="paw-print" style="top: 50%; left: 0; animation-delay: 6s;">üêæ</div>
    <div class="paw-print" style="top: 70%; left: 0; animation-delay: 9s;">üêæ</div>
    <div class="paw-print" style="top: 90%; left: 0; animation-delay: 12s;">üêæ</div>

    <div class="container">
        <header class="header">
            <h1>üêï Gassi-Tracker Ultimate üêæ</h1>
            <p style="color: white; font-size: 1.2rem;">Das vollumf√§ngliche Hundehalter-Erlebnis!</p>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <div class="nav-tab active" onclick="switchTab('utensilien')">
                <span>üß∞ Utensilien</span>
            </div>
            <div class="nav-tab" onclick="switchTab('runden')">
                <span>üó∫Ô∏è Runden</span>
            </div>
            <div class="nav-tab" onclick="switchTab('hundefreunde')">
                <span>üê∂ Hundefreunde</span>
            </div>
            <div class="nav-tab" onclick="switchTab('leckerli')">
                <span>üçñ Leckerli</span>
            </div>
            <div class="nav-tab" onclick="switchTab('training')">
                <span>üß† Training</span>
            </div>
            <div class="nav-tab" onclick="switchTab('gesundheit')">
                <span>‚öïÔ∏è Gesundheit</span>
            </div>
            <div class="nav-tab" onclick="switchTab('gassi')">
                <span>üö∂ GASSI STARTEN</span>
            </div>
        </nav>

        <!-- Content Panels -->
        <div id="utensilien" class="content-panel active">
            <div class="category-container">
                <div class="sub-panel">
                    <h3>üéØ Management der Utensilien</h3>
                    <div class="form-group">
                        <label>Trainingsset erstellen:</label>
                        <input type="text" class="form-control" id="utensilienSetName" placeholder="z.B. Stadt-Training">
                        <div id="utensilienSetItems" style="margin-top: 10px;">
                            <!-- Dynamisch gef√ºllte Checkboxen -->
                        </div>
                        <button class="btn btn-secondary" onclick="createSet('utensilien')">Set speichern</button>
                    </div>
                    <div class="kv-list" id="utensilienSets">
                        <!-- Gespeicherte Sets -->
                    </div>
                </div>
                <div class="sub-panel">
                    <h3>‚úèÔ∏è Utensilien erstellen</h3>
                    <div class="form-group">
                        <label>Name:</label>
                        <input type="text" class="form-control" id="utensilName" placeholder="z.B. Flexileine 5m">
                    </div>
                    <div class="form-group">
                        <label>Eigenschaften (Key-Value):</label>
                        <div id="utensilProperties">
                            <div class="metric-input">
                                <input type="text" class="form-control" placeholder="Eigenschaft" id="utensilKey">
                                <input type="text" class="form-control" placeholder="Wert" id="utensilValue">
                                <button class="btn" onclick="addProperty('utensil')">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="saveItem('utensilien')">Speichern</button>
                    <div class="kv-list" id="utensilienList">
                        <!-- Gespeicherte Utensilien -->
                    </div>
                </div>
            </div>
        </div>

        <div id="runden" class="content-panel">
            <div class="category-container">
                <div class="sub-panel">
                    <h3>üéØ Routen-Management</h3>
                    <div class="form-group">
                        <label>Routenset erstellen:</label>
                        <input type="text" class="form-control" id="rundenSetName" placeholder="z.B. Wochenend-Touren">
                        <div id="rundenSetItems" style="margin-top: 10px;">
                            <!-- Dynamisch gef√ºllte Checkboxen -->
                        </div>
                        <button class="btn btn-secondary" onclick="createSet('runden')">Set speichern</button>
                    </div>
                    <div class="kv-list" id="rundenSets">
                        <!-- Gespeicherte Sets -->
                    </div>
                </div>
                <div class="sub-panel">
                    <h3>‚úèÔ∏è Route erstellen</h3>
                    <div class="form-group">
                        <label>Routenname:</label>
                        <input type="text" class="form-control" id="routeName" placeholder="z.B. Waldspaziergang S√ºd">
                    </div>
                    <div class="form-group">
                        <label>Eigenschaften:</label>
                        <div id="routeProperties">
                            <div class="metric-input">
                                <input type="text" class="form-control" placeholder="z.B. L√§nge" id="routeKey">
                                <input type="text" class="form-control" placeholder="z.B. 3km" id="routeValue">
                                <button class="btn" onclick="addProperty('route')">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="saveItem('runden')">Route speichern</button>
                    <div class="kv-list" id="rundenList">
                        <!-- Gespeicherte Routen -->
                    </div>
                </div>
            </div>
        </div>

        <div id="hundefreunde" class="content-panel">
            <div class="category-container">
                <div class="sub-panel">
                    <h3>üéØ Hundegruppen verwalten</h3>
                    <div class="form-group">
                        <label>Gruppe erstellen:</label>
                        <input type="text" class="form-control" id="hundefreundeSetName" placeholder="z.B. Spielgruppe Dienstag">
                        <div id="hundefreundeSetItems" style="margin-top: 10px;">
                            <!-- Dynamisch gef√ºllte Checkboxen -->
                        </div>
                        <button class="btn btn-secondary" onclick="createSet('hundefreunde')">Gruppe speichern</button>
                    </div>
                    <div class="kv-list" id="hundefreundeSets">
                        <!-- Gespeicherte Gruppen -->
                    </div>
                </div>
                <div class="sub-panel">
                    <h3>‚úèÔ∏è Hundefreund hinzuf√ºgen</h3>
                    <div class="form-group">
                        <label>Name (Hund + Halter):</label>
                        <input type="text" class="form-control" id="dogFriendName" placeholder="z.B. Bello (Frau M√ºller)">
                    </div>
                    <div class="form-group">
                        <label>Eigenschaften:</label>
                        <div id="dogFriendProperties">
                            <div class="metric-input">
                                <input type="text" class="form-control" placeholder="z.B. Rasse" id="dogFriendKey">
                                <input type="text" class="form-control" placeholder="z.B. Golden Retriever" id="dogFriendValue">
                                <button class="btn" onclick="addProperty('dogFriend')">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="saveItem('hundefreunde')">Freund speichern</button>
                    <div class="kv-list" id="hundefreundeList">
                        <!-- Gespeicherte Hundefreunde -->
                    </div>
                </div>
            </div>
        </div>

        <div id="leckerli" class="content-panel">
            <div class="category-container">
                <div class="sub-panel">
                    <h3>üéØ Leckerli-Sets</h3>
                    <div class="form-group">
                        <label>Trainingspaket zusammenstellen:</label>
                        <input type="text" class="form-control" id="leckerliSetName" placeholder="z.B. R√ºckruf-Training">
                        <div id="leckerliSetItems" style="margin-top: 10px;">
                            <!-- Dynamisch gef√ºllte Checkboxen -->
                        </div>
                        <button class="btn btn-secondary" onclick="createSet('leckerli')">Paket speichern</button>
                    </div>
                    <div class="kv-list" id="leckerliSets">
                        <!-- Gespeicherte Pakete -->
                    </div>
                </div>
                <div class="sub-panel">
                    <h3>‚úèÔ∏è Leckerli hinzuf√ºgen</h3>
                    <div class="form-group">
                        <label>Bezeichnung:</label>
                        <input type="text" class="form-control" id="treatName" placeholder="z.B. K√§sew√ºrfel">
                    </div>
                    <div class="form-group">
                        <label>Eigenschaften:</label>
                        <div id="treatProperties">
                            <div class="metric-input">
                                <input type="text" class="form-control" placeholder="z.B. Wertigkeit" id="treatKey">
                                <input type="text" class="form-control" placeholder="z.B. Hoch" id="treatValue">
                                <button class="btn" onclick="addProperty('treat')">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="saveItem('leckerli')">Leckerli speichern</button>
                    <div class="kv-list" id="leckerliList">
                        <!-- Gespeicherte Leckerlis -->
                    </div>
                </div>
            </div>
        </div>

        <div id="training" class="content-panel">
            <div class="category-container">
                <div class="sub-panel">
                    <h3>üéØ Trainingseinheiten</h3>
                    <div class="form-group">
                        <label>Trainingsplan erstellen:</label>
                        <input type="text" class="form-control" id="trainingSetName" placeholder="z.B. Grundgehorsam">
                        <div id="trainingSetItems" style="margin-top: 10px;">
                            <!-- Dynamisch gef√ºllte Checkboxen -->
                        </div>
                        <button class="btn btn-secondary" onclick="createSet('training')">Plan speichern</button>
                    </div>
                    <div class="kv-list" id="trainingSets">
                        <!-- Gespeicherte Trainingspl√§ne -->
                    </div>
                </div>
                <div class="sub-panel">
                    <h3>‚úèÔ∏è √úbung erstellen</h3>
                    <div class="form-group">
                        <label>√úbungsname:</label>
                        <input type="text" class="form-control" id="exerciseName" placeholder="z.B. Sitz aus Bewegung">
                    </div>
                    <div class="form-group">
                        <label>Details:</label>
                        <div id="exerciseProperties">
                            <div class="metric-input">
                                <input type="text" class="form-control" placeholder="z.B. Schwierigkeit" id="exerciseKey">
                                <input type="text" class="form-control" placeholder="z.B. Mittel" id="exerciseValue">
                                <button class="btn" onclick="addProperty('exercise')">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="saveItem('training')">√úbung speichern</button>
                    <div class="kv-list" id="trainingList">
                        <!-- Gespeicherte √úbungen -->
                    </div>
                </div>
            </div>
        </div>

        <div id="gesundheit" class="content-panel">
            <div class="category-container">
                <div class="sub-panel">
                    <h3>üéØ Gesundheitsprofil</h3>
                    <div class="form-group">
                        <label>Profil erstellen:</label>
                        <input type="text" class="form-control" id="gesundheitSetName" placeholder="z.B. Allergie-Management">
                        <div id="gesundheitSetItems" style="margin-top: 10px;">
                            <!-- Dynamisch gef√ºllte Checkboxen -->
                        </div>
                        <button class="btn btn-secondary" onclick="createSet('gesundheit')">Profil speichern</button>
                    </div>
                    <div class="kv-list" id="gesundheitSets">
                        <!-- Gespeicherte Profile -->
                    </div>
                </div>
                <div class="sub-panel">
                    <h3>‚úèÔ∏è Gesundheitseintrag</h3>
                    <div class="form-group">
                        <label>Eintrag:</label>
                        <input type="text" class="form-control" id="healthName" placeholder="z.B. Gr√§serallergie">
                    </div>
                    <div class="form-group">
                        <label>Details:</label>
                        <div id="healthProperties">
                            <div class="metric-input">
                                <input type="text" class="form-control" placeholder="z.B. Symptome" id="healthKey">
                                <input type="text" class="form-control" placeholder="z.B. Juckreiz" id="healthValue">
                                <button class="btn" onclick="addProperty('health')">+</button>
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="saveItem('gesundheit')">Eintrag speichern</button>
                    <div class="kv-list" id="gesundheitList">
                        <!-- Gespeicherte Eintr√§ge -->
                    </div>
                </div>
            </div>
        </div>

        <!-- GASSI RUNDE -->
        <div id="gassi" class="content-panel">
            <div class="gassi-panel">
                <h2 style="text-align: center; color: var(--accent); font-size: 2.5rem; margin-bottom: 30px;">
                    üö∂ GASSI-RUNDE üêï
                </h2>

                <div class="timer-display" id="timerDisplay">00:00:00</div>

                <div class="control-buttons">
                    <button class="btn" onclick="startGassi()" id="startBtn">
                        ‚ñ∂Ô∏è START
                    </button>
                    <button class="btn btn-secondary" onclick="pauseGassi()" id="pauseBtn" disabled>
                        ‚è∏Ô∏è PAUSE
                    </button>
                    <button class="btn btn-danger" onclick="stopGassi()" id="stopBtn" disabled>
                        ‚èπÔ∏è STOP
                    </button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìç</div>
                        <div class="stat-value" id="distanceStat">0.0</div>
                        <div class="stat-label">Kilometer</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë£</div>
                        <div class="stat-value" id="stepsStat">0</div>
                        <div class="stat-label">Schritte</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value" id="speedStat">0.0</div>
                        <div class="stat-label">km/h</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üõë</div>
                        <div class="stat-value" id="pausesStat">0</div>
                        <div class="stat-label">Pausen</div>
                    </div>
                </div>

                <!-- Kot-Erfassung -->
                <div class="form-group" style="margin-top: 30px;">
                    <h3 style="color: white;">üí© Kot-Konsistenz erfassen</h3>
                    <div class="slider-container">
                        <input type="range" class="slider" id="poopSlider" min="1" max="10" value="5">
                        <div class="slider-value">
                            <span id="poopValue">5</span> - <span id="poopDesc">Normal</span>
                        </div>
                    </div>
                </div>

                <!-- Dynamische Metriken -->
                <div class="form-group">
                    <h3 style="color: white;">üìä Weitere Metriken</h3>
                    <div id="dynamicMetrics">
                        <!-- Dynamisch hinzugef√ºgte Metriken -->
                    </div>
                    <div class="metric-input">
                        <input type="text" class="form-control" placeholder="Neue Metrik" id="newMetricName">
                        <button class="btn" onclick="addMetric()">+ Metrik</button>
                    </div>
                </div>

                <!-- Hundefreunde getroffen -->
                <div class="form-group">
                    <h3 style="color: white;">üê∂ Getroffene Hundefreunde</h3>
                    <div id="metDogFriends">
                        <!-- Checkboxen f√ºr Hundefreunde -->
                    </div>
                </div>

                <!-- Karte -->
                <div id="map"></div>
            </div>
        </div>
    </div>

    <script>
        // Globale Variablen
        let gassiData = {
            categories: {
                utensilien: { items: [], sets: [] },
                runden: { items: [], sets: [] },
                hundefreunde: { items: [], sets: [] },
                leckerli: { items: [], sets: [] },
                training: { items: [], sets: [] },
                gesundheit: { items: [], sets: [] }
            },
            gassiRounds: [],
            activeRound: null,
            metrics: ['Stimmung', 'Energie', 'Stress', 'Aufmerksamkeit']
        };

        // Timer Variablen
        let timerInterval = null;
        let startTime = null;
        let elapsedTime = 0;
        let isPaused = false;
        let pauseCount = 0;

        // Map Variablen
        let map = null;
        let routePath = [];
        let routeLine = null;
        let currentMarker = null;
        let gpsInterval = null;

        // Initialisierung
        window.onload = function() {
            loadData();
            initializeMap();
            updateAllLists();
            updatePoopDescription();
        };

        // Daten laden/speichern
        function loadData() {
            const saved = JSON.parse(localStorage.getItem('gassiData') || '{}');
            gassiData = { ...gassiData, ...saved };
        }

        function saveData() {
            localStorage.setItem('gassiData', JSON.stringify(gassiData));
        }

        // Tab-Wechsel
        function switchTab(tabId) {
            // Alle Tabs und Panels deaktivieren
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-panel').forEach(panel => panel.classList.remove('active'));

            // Aktiven Tab setzen
            event.target.closest('.nav-tab').classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }

        // Properties hinzuf√ºgen
        function addProperty(type) {
            const keyInput = document.getElementById(type + 'Key');
            const valueInput = document.getElementById(type + 'Value');

            if (!keyInput || !valueInput) return;

            const key = keyInput.value.trim();
            const value = valueInput.value.trim();

            if (key && value) {
                const container = keyInput.parentElement.parentElement;
                const propDiv = document.createElement('div');
                propDiv.className = 'kv-item';
                propDiv.innerHTML = `
                    <span class="kv-key">${key}:</span>
                    <span class="kv-value">${value}</span>
                    <button class="btn btn-danger" onclick="this.parentElement.remove()">‚ùå</button>
                `;
                container.appendChild(propDiv);

                keyInput.value = '';
                valueInput.value = '';
            }
        }

        // Items speichern
        function saveItem(category) {
            let name, properties = {};

            // Name ermitteln
            switch(category) {
                case 'utensilien':
                    name = document.getElementById('utensilName').value;
                    break;
                case 'runden':
                    name = document.getElementById('routeName').value;
                    break;
                case 'hundefreunde':
                    name = document.getElementById('dogFriendName').value;
                    break;
                case 'leckerli':
                    name = document.getElementById('treatName').value;
                    break;
                case 'training':
                    name = document.getElementById('exerciseName').value;
                    break;
                case 'gesundheit':
                    name = document.getElementById('healthName').value;
                    break;
            }

            if (!name) {
                alert('Bitte einen Namen eingeben!');
                return;
            }

            // Properties sammeln
            const container = document.querySelector(`#${category} .sub-panel:nth-child(2) .kv-list`).previousElementSibling;
            const kvItems = container.querySelectorAll('.kv-item');

            kvItems.forEach(item => {
                const key = item.querySelector('.kv-key').textContent.replace(':', '');
                const value = item.querySelector('.kv-value').textContent;
                properties[key] = value;
            });

            // Item speichern
            const newItem = {
                id: Date.now(),
                name: name,
                properties: properties,
                created: new Date().toISOString()
            };

            gassiData.categories[category].items.push(newItem);
            saveData();
            updateAllLists();

            // Form zur√ºcksetzen
            document.querySelector(`#${category} input[type="text"]`).value = '';
            kvItems.forEach(item => item.remove());

            alert(`${name} wurde gespeichert! üéâ`);
        }

        // Sets erstellen
        function createSet(category) {
            const setName = document.getElementById(category + 'SetName').value;
            if (!setName) {
                alert('Bitte einen Namen f√ºr das Set eingeben!');
                return;
            }

            const selectedItems = [];
            const checkboxes = document.querySelectorAll(`#${category}SetItems input[type="checkbox"]:checked`);

            checkboxes.forEach(cb => {
                selectedItems.push(parseInt(cb.value));
            });

            if (selectedItems.length === 0) {
                alert('Bitte mindestens ein Element ausw√§hlen!');
                return;
            }

            const newSet = {
                id: Date.now(),
                name: setName,
                items: selectedItems,
                created: new Date().toISOString()
            };

            gassiData.categories[category].sets.push(newSet);
            saveData();
            updateAllLists();

            document.getElementById(category + 'SetName').value = '';
            alert(`Set "${setName}" wurde erstellt! üéâ`);
        }

        // Listen aktualisieren
        function updateAllLists() {
            Object.keys(gassiData.categories).forEach(category => {
                updateItemList(category);
                updateSetList(category);
                updateSetCheckboxes(category);
            });
            updateMetDogFriends();
        }

        function updateItemList(category) {
            const listEl = document.getElementById(category + 'List');
            if (!listEl) return;

            listEl.innerHTML = '';
            gassiData.categories[category].items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'kv-item';
                itemDiv.innerHTML = `
                    <div>
                        <strong>${item.name}</strong>
                        ${Object.entries(item.properties).map(([k, v]) =>
                            `<br><small>${k}: ${v}</small>`
                        ).join('')}
                    </div>
                    <button class="btn btn-danger" onclick="deleteItem('${category}', ${item.id})">üóëÔ∏è</button>
                `;
                listEl.appendChild(itemDiv);
            });
        }

        function updateSetList(category) {
            const listEl = document.getElementById(category + 'Sets');
            if (!listEl) return;

            listEl.innerHTML = '';
            gassiData.categories[category].sets.forEach(set => {
                const setDiv = document.createElement('div');
                setDiv.className = 'kv-item';

                const itemNames = set.items.map(id => {
                    const item = gassiData.categories[category].items.find(i => i.id === id);
                    return item ? item.name : 'Gel√∂scht';
                }).join(', ');

                setDiv.innerHTML = `
                    <div>
                        <strong>${set.name}</strong>
                        <br><small>Enth√§lt: ${itemNames}</small>
                    </div>
                    <button class="btn btn-danger" onclick="deleteSet('${category}', ${set.id})">üóëÔ∏è</button>
                `;
                listEl.appendChild(setDiv);
            });
        }

        function updateSetCheckboxes(category) {
            const container = document.getElementById(category + 'SetItems');
            if (!container) return;

            container.innerHTML = '';
            gassiData.categories[category].items.forEach(item => {
                const checkDiv = document.createElement('div');
                checkDiv.innerHTML = `
                    <label style="color: white; display: block; margin: 5px 0;">
                        <input type="checkbox" value="${item.id}" style="margin-right: 10px;">
                        ${item.name}
                    </label>
                `;
                container.appendChild(checkDiv);
            });
        }

        function deleteItem(category, id) {
            if (confirm('Wirklich l√∂schen?')) {
                gassiData.categories[category].items =
                    gassiData.categories[category].items.filter(i => i.id !== id);
                saveData();
                updateAllLists();
            }
        }

        function deleteSet(category, id) {
            if (confirm('Wirklich l√∂schen?')) {
                gassiData.categories[category].sets =
                    gassiData.categories[category].sets.filter(s => s.id !== id);
                saveData();
                updateAllLists();
            }
        }

        // Gassi-Funktionen
        function startGassi() {
            if (!isPaused) {
                startTime = Date.now();
                elapsedTime = 0;
                routePath = [];
                pauseCount = 0;

                gassiData.activeRound = {
                    id: Date.now(),
                    startTime: new Date().toISOString(),
                    route: [],
                    metrics: {},
                    dogFriends: [],
                    poopConsistency: 5
                };

                // Karte zur√ºcksetzen
                if (routeLine) {
                    map.removeLayer(routeLine);
                }

                // GPS Tracking starten
                startGPSTracking();
            } else {
                isPaused = false;
            }

            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('stopBtn').disabled = false;

            startTimer();

            // Schritte simulieren
            simulateSteps();
        }

        function pauseGassi() {
            isPaused = true;
            pauseCount++;
            document.getElementById('pausesStat').textContent = pauseCount;

            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').textContent = '‚ñ∂Ô∏è WEITER';
            document.getElementById('pauseBtn').disabled = true;

            clearInterval(timerInterval);
        }

        function stopGassi() {
            clearInterval(timerInterval);
            clearInterval(gpsInterval);

            // Daten sammeln
            if (gassiData.activeRound) {
                gassiData.activeRound.endTime = new Date().toISOString();
                gassiData.activeRound.duration = elapsedTime;
                gassiData.activeRound.pauseCount = pauseCount;
                gassiData.activeRound.distance = parseFloat(document.getElementById('distanceStat').textContent);
                gassiData.activeRound.steps = parseInt(document.getElementById('stepsStat').textContent);
                gassiData.activeRound.poopConsistency = parseInt(document.getElementById('poopSlider').value);

                // Metriken sammeln
                document.querySelectorAll('#dynamicMetrics input').forEach(input => {
                    gassiData.activeRound.metrics[input.dataset.metric] = input.value;
                });

                // Hundefreunde sammeln
                document.querySelectorAll('#metDogFriends input:checked').forEach(cb => {
                    gassiData.activeRound.dogFriends.push(parseInt(cb.value));
                });

                gassiData.gassiRounds.push(gassiData.activeRound);
                gassiData.activeRound = null;
                saveData();

                alert('Gassi-Runde gespeichert! üéâ');
            }

            // UI zur√ºcksetzen
            document.getElementById('timerDisplay').textContent = '00:00:00';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').textContent = '‚ñ∂Ô∏è START';
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;

            // Stats zur√ºcksetzen
            document.getElementById('distanceStat').textContent = '0.0';
            document.getElementById('stepsStat').textContent = '0';
            document.getElementById('speedStat').textContent = '0.0';
            document.getElementById('pausesStat').textContent = '0';
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (!isPaused) {
                    elapsedTime = Date.now() - startTime;
                    const hours = Math.floor(elapsedTime / 3600000);
                    const minutes = Math.floor((elapsedTime % 3600000) / 60000);
                    const seconds = Math.floor((elapsedTime % 60000) / 1000);

                    document.getElementById('timerDisplay').textContent =
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 100);
        }

        // Karte initialisieren
        function initializeMap() {
            map = L.map('map').setView([51.0504, 13.7373], 13); // Dresden

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
        }

        // GPS Tracking
        function startGPSTracking() {
            if (navigator.geolocation) {
                gpsInterval = setInterval(() => {
                    navigator.geolocation.getCurrentPosition(position => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;

                        routePath.push([lat, lng]);

                        if (gassiData.activeRound) {
                            gassiData.activeRound.route.push({
                                lat: lat,
                                lng: lng,
                                timestamp: new Date().toISOString()
                            });
                        }

                        // Route auf Karte aktualisieren
                        if (routeLine) {
                            map.removeLayer(routeLine);
                        }

                        routeLine = L.polyline(routePath, {
                            color: 'red',
                            weight: 4,
                            opacity: 0.8
                        }).addTo(map);

                        // Marker aktualisieren
                        if (currentMarker) {
                            map.removeLayer(currentMarker);
                        }

                        currentMarker = L.marker([lat, lng], {
                            icon: L.divIcon({
                                html: 'üêï',
                                iconSize: [30, 30],
                                className: 'dog-marker'
                            })
                        }).addTo(map);

                        map.setView([lat, lng], 15);

                        // Distanz berechnen
                        if (routePath.length > 1) {
                            let totalDistance = 0;
                            for (let i = 1; i < routePath.length; i++) {
                                totalDistance += calculateDistance(
                                    routePath[i-1][0], routePath[i-1][1],
                                    routePath[i][0], routePath[i][1]
                                );
                            }
                            document.getElementById('distanceStat').textContent = totalDistance.toFixed(2);

                            // Geschwindigkeit berechnen
                            const hours = elapsedTime / 3600000;
                            const speed = hours > 0 ? totalDistance / hours : 0;
                            document.getElementById('speedStat').textContent = speed.toFixed(1);
                        }
                    });
                }, 60000); // Alle 60 Sekunden
            }
        }

        // Distanz berechnen (Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Erdradius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Schritte simulieren
        function simulateSteps() {
            setInterval(() => {
                if (!isPaused && gassiData.activeRound) {
                    const currentSteps = parseInt(document.getElementById('stepsStat').textContent);
                    // ~2 Schritte pro Sekunde beim Gehen
                    document.getElementById('stepsStat').textContent = currentSteps + 2;
                }
            }, 1000);
        }

        // Kot-Slider
        document.getElementById('poopSlider').addEventListener('input', updatePoopDescription);

        function updatePoopDescription() {
            const value = document.getElementById('poopSlider').value;
            document.getElementById('poopValue').textContent = value;

            const descriptions = {
                1: 'Sehr weich/fl√ºssig',
                2: 'Weich mit wenig Form',
                3: 'Weich aber geformt',
                4: 'Gut geformt, feucht',
                5: 'Normal, optimal',
                6: 'Fest, trocken',
                7: 'Sehr fest',
                8: 'Hart, trocken',
                9: 'Sehr hart',
                10: 'Steinhart'
            };

            document.getElementById('poopDesc').textContent = descriptions[value];
        }

        // Dynamische Metriken
        function addMetric() {
            const metricName = document.getElementById('newMetricName').value;
            if (!metricName) return;

            gassiData.metrics.push(metricName);
            saveData();

            const metricDiv = document.createElement('div');
            metricDiv.className = 'form-group';
            metricDiv.innerHTML = `
                <label style="color: white;">${metricName}:</label>
                <input type="text" class="form-control" data-metric="${metricName}"
                       placeholder="Wert eingeben">
            `;

            document.getElementById('dynamicMetrics').appendChild(metricDiv);
            document.getElementById('newMetricName').value = '';
        }

        // Hundefreunde f√ºr Gassi
        function updateMetDogFriends() {
            const container = document.getElementById('metDogFriends');
            if (!container) return;

            container.innerHTML = '';
            gassiData.categories.hundefreunde.items.forEach(friend => {
                const checkDiv = document.createElement('div');
                checkDiv.innerHTML = `
                    <label style="color: white; display: block; margin: 5px 0;">
                        <input type="checkbox" value="${friend.id}" style="margin-right: 10px;">
                        ${friend.name}
                    </label>
                `;
                container.appendChild(checkDiv);
            });
        }

        // Standard-Metriken laden
        window.addEventListener('load', () => {
            gassiData.metrics.forEach(metric => {
                const metricDiv = document.createElement('div');
                metricDiv.className = 'form-group';
                metricDiv.innerHTML = `
                    <label style="color: white;">${metric}:</label>
                    <input type="text" class="form-control" data-metric="${metric}"
                           placeholder="Wert eingeben">
                `;
                document.getElementById('dynamicMetrics').appendChild(metricDiv);
            });
        });
    </script>
</body>
</html>