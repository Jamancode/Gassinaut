<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Umfassende Hundegassi-App f√ºr Tracking, Training und Gesundheitsmanagement">
    <title>üêï Hundegassi Pro - Vollst√§ndiges Hundemanagement</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiSHVuZGVnYXNzaSBQcm8iLCJzaG9ydF9uYW1lIjoiSHVuZGVnYXNzaSIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInRoZW1lX2NvbG9yIjoiIzJkNzNmZiIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5qUWlJR2hsYVdkb2REMGlOalFpSUdacGJHdzlJaU0yTXpZek5tWWlQaUE4Y0dGMGFDQmtQU0pOTVRJZ01qQmpOQ280TGpZZ05DNDJJRGc4TFMxNklqOCtQQzl6ZG1jKyIsInNpemVzIjoiNjR4NjQiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <style>
        :root {
            --primary-color: #2d73ff;
            --secondary-color: #ff6b35;
            --success-color: #10d876;
            --warning-color: #ffb800;
            --danger-color: #ff3b30;
            --background-color: #ffffff;
            --surface-color: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --border-color: #e9ecef;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-hover: 0 4px 20px rgba(0,0,0,0.15);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --background-color: #1a1a1a;
            --surface-color: #2d2d2d;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --border-color: #404040;
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
            --shadow-hover: 0 4px 20px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--surface-color);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .theme-toggle {
            background: none;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .nav-tabs {
            display: flex;
            background: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            padding: 0 1rem;
        }

        .nav-tab {
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: var(--transition);
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            position: relative;
        }

        .nav-tab:hover {
            color: var(--primary-color);
            background: rgba(45, 115, 255, 0.05);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: rgba(45, 115, 255, 0.1);
        }

        .tab-content {
            flex: 1;
            padding: 2rem 1rem;
        }

        .tab-pane {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-pane.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn:hover {
            background: #1c5ce6;
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }

        .btn.btn-secondary {
            background: var(--text-secondary);
        }

        .btn.btn-secondary:hover {
            background: #495057;
        }

        .btn.btn-success {
            background: var(--success-color);
        }

        .btn.btn-warning {
            background: var(--warning-color);
        }

        .btn.btn-danger {
            background: var(--danger-color);
        }

        .btn.btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn.btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--background-color);
            color: var(--text-primary);
            transition: var(--transition);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(45, 115, 255, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: var(--background-color);
            color: var(--text-primary);
            cursor: pointer;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .stat-card {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), #4285ff);
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .calendar {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--primary-color);
            color: white;
        }

        .calendar-nav {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: var(--transition);
        }

        .calendar-nav:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day-header {
            padding: 1rem 0.5rem;
            text-align: center;
            font-weight: 600;
            background: var(--border-color);
            color: var(--text-secondary);
        }

        .calendar-day {
            padding: 1rem 0.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: var(--transition);
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .calendar-day:hover {
            background: var(--primary-color);
            color: white;
        }

        .calendar-day.has-events {
            background: rgba(45, 115, 255, 0.1);
        }

        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--primary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            padding: 2rem;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: slideIn 0.3s ease-in-out;
        }

        @keyframes slideIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .timer-display {
            text-align: center;
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
        }

        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            transition: var(--transition);
        }

        .list-item:hover {
            background: rgba(45, 115, 255, 0.05);
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .badge {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .badge.success {
            background: var(--success-color);
        }

        .badge.warning {
            background: var(--warning-color);
        }

        .badge.danger {
            background: var(--danger-color);
        }

        .achievement {
            background: linear-gradient(135deg, var(--warning-color), #ffd700);
            color: #333;
            padding: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
            font-weight: 600;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .chart-container {
            height: 300px;
            display: flex;
            align-items: end;
            justify-content: space-around;
            padding: 1rem;
            border-bottom: 2px solid var(--border-color);
            position: relative;
        }

        .chart-bar {
            background: var(--primary-color);
            width: 30px;
            min-height: 10px;
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            background: var(--secondary-color);
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-item {
            aspect-ratio: 1;
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
        }

        .photo-item:hover {
            transform: scale(1.05);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .floating-action {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-hover);
            transition: var(--transition);
            z-index: 100;
        }

        .floating-action:hover {
            transform: scale(1.1);
            background: #1c5ce6;
        }

        @media (max-width: 768px) {
            .nav-tabs {
                padding: 0;
            }

            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.8rem;
            }

            .tab-content {
                padding: 1rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }

            .timer-display {
                font-size: 2rem;
            }

            .modal-content {
                margin: 1rem;
                padding: 1.5rem;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body data-theme="light">
    <div class="app-container">
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">üêï Hundegassi Pro</h1>
                <button class="theme-toggle" onclick="app.toggleTheme()" aria-label="Theme umschalten">üåô</button>
            </div>
        </header>

        <nav class="nav-tabs" role="tablist">
            <button class="nav-tab active" data-tab="dashboard" onclick="app.switchTab('dashboard')" role="tab" aria-selected="true">üìä Dashboard</button>
            <button class="nav-tab" data-tab="profile" onclick="app.switchTab('profile')" role="tab">üêï Profil</button>
            <button class="nav-tab" data-tab="tracker" onclick="app.switchTab('tracker')" role="tab">üö∂ Tracker</button>
            <button class="nav-tab" data-tab="calendar" onclick="app.switchTab('calendar')" role="tab">üìÖ Kalender</button>
            <button class="nav-tab" data-tab="training" onclick="app.switchTab('training')" role="tab">üéØ Training</button>
            <button class="nav-tab" data-tab="feeding" onclick="app.switchTab('feeding')" role="tab">üçΩÔ∏è F√ºtterung</button>
            <button class="nav-tab" data-tab="stats" onclick="app.switchTab('stats')" role="tab">üìà Statistiken</button>
            <button class="nav-tab" data-tab="settings" onclick="app.switchTab('settings')" role="tab">‚öôÔ∏è Einstellungen</button>
        </nav>

        <main class="tab-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-pane active" role="tabpanel">
                <div class="grid grid-4">
                    <div class="stat-card">
                        <div class="stat-number" id="totalWalks">0</div>
                        <div class="stat-label">Spazierg√§nge</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalDistance">0</div>
                        <div class="stat-label">km gelaufen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalTime">0</div>
                        <div class="stat-label">Stunden aktiv</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="trainingSessions">0</div>
                        <div class="stat-label">Trainings</div>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Heutige Aktivit√§ten</h2>
                            <button class="btn btn-outline" onclick="app.switchTab('tracker')">+ Spaziergang</button>
                        </div>
                        <div id="todayActivities">
                            <div class="empty-state">
                                <div class="empty-state-icon">üö∂</div>
                                <p>Noch keine Aktivit√§ten heute</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Letzte Trainings</h2>
                            <button class="btn btn-outline" onclick="app.switchTab('training')">+ Training</button>
                        </div>
                        <div id="recentTraining">
                            <div class="empty-state">
                                <div class="empty-state-icon">üéØ</div>
                                <p>Noch keine Trainings</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Wochen√ºbersicht</h2>
                    </div>
                    <div class="chart-container" id="weeklyChart">
                        <!-- Chart wird hier generiert -->
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profile" class="tab-pane" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Hundeprofil</h2>
                        <button class="btn" onclick="app.showProfileForm()">‚úèÔ∏è Bearbeiten</button>
                    </div>
                    <div id="profileContent">
                        <div class="empty-state">
                            <div class="empty-state-icon">üêï</div>
                            <p>Noch kein Hundeprofil erstellt</p>
                            <button class="btn" onclick="app.showProfileForm()">Profil erstellen</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tracker Tab -->
            <div id="tracker" class="tab-pane" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Gassi-Tracker</h2>
                    </div>
                    <div class="timer-display" id="timerDisplay">00:00:00</div>
                    <div class="timer-controls">
                        <button class="btn btn-success" id="startBtn" onclick="app.tracker.start()">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-warning" id="pauseBtn" onclick="app.tracker.pause()" disabled>‚è∏Ô∏è Pause</button>
                        <button class="btn btn-danger" id="stopBtn" onclick="app.tracker.stop()" disabled>‚èπÔ∏è Stop</button>
                    </div>

                    <div class="card" style="margin-top: 2rem;">
                        <h3>Aktuelle Session</h3>
                        <div class="grid grid-2">
                            <div>
                                <label class="form-label">Distanz (km)</label>
                                <input type="number" id="currentDistance" class="form-input" step="0.1" value="0">
                            </div>
                            <div>
                                <label class="form-label">Wetter</label>
                                <select id="currentWeather" class="form-select">
                                    <option value="sonnig">‚òÄÔ∏è Sonnig</option>
                                    <option value="bew√∂lkt">‚òÅÔ∏è Bew√∂lkt</option>
                                    <option value="regnerisch">üåßÔ∏è Regnerisch</option>
                                    <option value="schnee">‚ùÑÔ∏è Schnee</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Ereignisse hinzuf√ºgen</label>
                            <div class="timer-controls">
                                <button class="btn btn-outline" onclick="app.tracker.addEvent('poop')">üí© Kot</button>
                                <button class="btn btn-outline" onclick="app.tracker.addEvent('pee')">üíß Urin</button>
                                <button class="btn btn-outline" onclick="app.tracker.addEvent('social')">üêï Sozialkontakt</button>
                                <button class="btn btn-outline" onclick="app.tracker.addEvent('training')">üéØ Training</button>
                            </div>
                        </div>

                        <div id="currentEvents"></div>
                    </div>
                </div>
            </div>

            <!-- Calendar Tab -->
            <div id="calendar" class="tab-pane" role="tabpanel">
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="app.calendar.prevMonth()">‚ùÆ</button>
                        <h2 id="calendarTitle">November 2024</h2>
                        <button class="calendar-nav" onclick="app.calendar.nextMonth()">‚ùØ</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-day-header">Mo</div>
                        <div class="calendar-day-header">Di</div>
                        <div class="calendar-day-header">Mi</div>
                        <div class="calendar-day-header">Do</div>
                        <div class="calendar-day-header">Fr</div>
                        <div class="calendar-day-header">Sa</div>
                        <div class="calendar-day-header">So</div>
                        <!-- Calendar days will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Training Tab -->
            <div id="training" class="tab-pane" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Training & Tricks</h2>
                        <button class="btn" onclick="app.showTrainingForm()">+ Neues Training</button>
                    </div>
                    <div id="trainingList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <p>Noch keine Trainings erfasst</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Feeding Tab -->
            <div id="feeding" class="tab-pane" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">F√ºtterung</h2>
                        <button class="btn" onclick="app.showFeedingForm()">+ F√ºtterung</button>
                    </div>
                    <div id="feedingList">
                        <div class="empty-state">
                            <div class="empty-state-icon">üçΩÔ∏è</div>
                            <p>Noch keine F√ºtterungen erfasst</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Tab -->
            <div id="stats" class="tab-pane" role="tabpanel">
                <div class="grid grid-2">
                    <div class="card">
                        <h3>Aktivit√§ts-Trend</h3>
                        <div class="chart-container" id="activityChart">
                            <!-- Chart -->
                        </div>
                    </div>
                    <div class="card">
                        <h3>Training-Erfolg</h3>
                        <div class="chart-container" id="trainingChart">
                            <!-- Chart -->
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3>Detaillierte Statistiken</h3>
                    <div id="detailStats"></div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-pane" role="tabpanel">
                <div class="card">
                    <h3>Daten verwalten</h3>
                    <div class="timer-controls">
                        <button class="btn" onclick="app.exportData()">üì§ Daten exportieren</button>
                        <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì• Daten importieren</button>
                        <button class="btn btn-danger" onclick="app.clearAllData()">üóëÔ∏è Alle Daten l√∂schen</button>
                    </div>
                    <input type="file" id="importFile" accept=".csv,.json" style="display: none;" onchange="app.importData(event)">
                </div>

                <div class="card">
                    <h3>App-Einstellungen</h3>
                    <div class="form-group">
                        <label class="form-label">Standard-Wetter</label>
                        <select id="defaultWeather" class="form-select">
                            <option value="sonnig">‚òÄÔ∏è Sonnig</option>
                            <option value="bew√∂lkt">‚òÅÔ∏è Bew√∂lkt</option>
                            <option value="regnerisch">üåßÔ∏è Regnerisch</option>
                            <option value="schnee">‚ùÑÔ∏è Schnee</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Benachrichtigungen</label>
                        <input type="checkbox" id="notifications"> T√§gliche Erinnerungen aktivieren
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeModal('profileModal')">&times;</button>
            <h2>Hundeprofil bearbeiten</h2>
            <form id="profileForm">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Name *</label>
                        <input type="text" id="dogName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Rasse</label>
                        <input type="text" id="dogBreed" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Geburtstag</label>
                        <input type="date" id="dogBirthDate" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gewicht (kg)</label>
                        <input type="number" id="dogWeight" class="form-input" step="0.1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Chip-Nummer</label>
                        <input type="text" id="dogChip" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Energielevel (1-5)</label>
                        <input type="range" id="dogEnergy" class="form-input" min="1" max="5" value="3">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Allergien</label>
                    <textarea id="dogAllergies" class="form-input form-textarea" placeholder="Bekannte Allergien..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Verhaltensnotizen</label>
                    <textarea id="dogBehavior" class="form-input form-textarea" placeholder="Besonderheiten im Verhalten..."></textarea>
                </div>

                <div class="timer-controls">
                    <button type="submit" class="btn">üíæ Speichern</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal('profileModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <div id="trainingModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeModal('trainingModal')">&times;</button>
            <h2>Training hinzuf√ºgen</h2>
            <form id="trainingForm">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Trick/Kommando *</label>
                        <input type="text" id="trainingTrick" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Schwierigkeit (1-5)</label>
                        <input type="range" id="trainingDifficulty" class="form-input" min="1" max="5" value="3">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Versuche</label>
                        <input type="number" id="trainingAttempts" class="form-input" min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Erfolgreiche Versuche</label>
                        <input type="number" id="trainingSuccesses" class="form-input" min="0" value="0">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Notizen</label>
                    <textarea id="trainingNotes" class="form-input form-textarea" placeholder="Trainingsnotizen..."></textarea>
                </div>

                <div class="timer-controls">
                    <button type="submit" class="btn">üíæ Speichern</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal('trainingModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <div id="feedingModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="app.closeModal('feedingModal')">&times;</button>
            <h2>F√ºtterung hinzuf√ºgen</h2>
            <form id="feedingForm">
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">Futter-Typ</label>
                        <select id="feedingType" class="form-select">
                            <option value="trockenfutter">ü•ò Trockenfutter</option>
                            <option value="nassfutter">üçñ Nassfutter</option>
                            <option value="leckerlis">üç™ Leckerlis</option>
                            <option value="knochen">ü¶¥ Knochen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Menge (g)</label>
                        <input type="number" id="feedingAmount" class="form-input" min="1">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uhrzeit</label>
                        <input type="time" id="feedingTime" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Wasser (ml)</label>
                        <input type="number" id="feedingWater" class="form-input" min="0">
                    </div>
                </div>

                <div class="timer-controls">
                    <button type="submit" class="btn">üíæ Speichern</button>
                    <button type="button" class="btn btn-secondary" onclick="app.closeModal('feedingModal')">Abbrechen</button>
                </div>
            </form>
        </div>
    </div>

    <button class="floating-action" onclick="app.switchTab('tracker')" aria-label="Schnell Spaziergang starten">üö∂</button>

    <script>
        class HundegassiApp {
            constructor() {
                this.data = {
                    profile: null,
                    walks: [],
                    training: [],
                    feeding: [],
                    settings: {
                        theme: 'light',
                        defaultWeather: 'sonnig',
                        notifications: false
                    }
                };

                this.tracker = new WalkTracker();
                this.calendar = new Calendar();

                this.loadData();
                this.initializeApp();
            }

            initializeApp() {
                this.updateDashboard();
                this.updateProfile();
                this.calendar.render();
                this.setTheme(this.data.settings.theme);

                // Event Listeners
                document.getElementById('profileForm').addEventListener('submit', (e) => this.saveProfile(e));
                document.getElementById('trainingForm').addEventListener('submit', (e) => this.saveTraining(e));
                document.getElementById('feedingForm').addEventListener('submit', (e) => this.saveFeeding(e));
            }

            loadData() {
                try {
                    const stored = localStorage.getItem('hundegassi_data');
                    if (stored) {
                        const parsed = JSON.parse(stored);
                        this.data = { ...this.data, ...parsed };
                    }
                } catch (error) {
                    console.error('Fehler beim Laden der Daten:', error);
                }
            }

            saveData() {
                try {
                    localStorage.setItem('hundegassi_data', JSON.stringify(this.data));
                } catch (error) {
                    console.error('Fehler beim Speichern der Daten:', error);
                    alert('Fehler beim Speichern der Daten!');
                }
            }

            switchTab(tabName) {
                // Update tab buttons
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                    tab.setAttribute('aria-selected', 'false');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
                document.querySelector(`[data-tab="${tabName}"]`).setAttribute('aria-selected', 'true');

                // Update tab content
                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');

                // Update specific tab content
                switch (tabName) {
                    case 'dashboard':
                        this.updateDashboard();
                        break;
                    case 'calendar':
                        this.calendar.render();
                        break;
                    case 'training':
                        this.updateTrainingList();
                        break;
                    case 'feeding':
                        this.updateFeedingList();
                        break;
                    case 'stats':
                        this.updateStats();
                        break;
                }
            }

            toggleTheme() {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);
            }

            setTheme(theme) {
                document.body.setAttribute('data-theme', theme);
                document.querySelector('.theme-toggle').textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                this.data.settings.theme = theme;
                this.saveData();
            }

            updateDashboard() {
                const totalWalks = this.data.walks.length;
                const totalDistance = this.data.walks.reduce((sum, walk) => sum + (walk.distance || 0), 0);
                const totalTime = this.data.walks.reduce((sum, walk) => sum + (walk.duration || 0), 0);
                const totalTraining = this.data.training.length;

                document.getElementById('totalWalks').textContent = totalWalks;
                document.getElementById('totalDistance').textContent = totalDistance.toFixed(1);
                document.getElementById('totalTime').textContent = Math.round(totalTime / 3600);
                document.getElementById('trainingSessions').textContent = totalTraining;

                this.updateTodayActivities();
                this.updateRecentTraining();
                this.updateWeeklyChart();
            }

            updateTodayActivities() {
                const today = new Date().toISOString().split('T')[0];
                const todayWalks = this.data.walks.filter(walk => walk.date === today);
                const todayFeeding = this.data.feeding.filter(feed => feed.date === today);

                const container = document.getElementById('todayActivities');

                if (todayWalks.length === 0 && todayFeeding.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üö∂</div>
                            <p>Noch keine Aktivit√§ten heute</p>
                        </div>
                    `;
                    return;
                }

                let html = '';

                todayWalks.forEach(walk => {
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>üö∂ Spaziergang</strong><br>
                                <small>${walk.startTime} - ${walk.endTime || 'laufend'}</small><br>
                                <small>${walk.distance || 0} km, ${this.formatDuration(walk.duration || 0)}</small>
                            </div>
                            <span class="badge">${walk.weather}</span>
                        </div>
                    `;
                });

                todayFeeding.forEach(feed => {
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>üçΩÔ∏è F√ºtterung</strong><br>
                                <small>${feed.time} - ${feed.foodType}</small><br>
                                <small>${feed.amount}g</small>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            updateRecentTraining() {
                const recentTraining = this.data.training.slice(-3);
                const container = document.getElementById('recentTraining');

                if (recentTraining.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <p>Noch keine Trainings</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                recentTraining.forEach(training => {
                    const successRate = Math.round((training.successes / training.attempts) * 100);
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>${training.trick}</strong><br>
                                <small>${training.lastPracticed}</small>
                            </div>
                            <span class="badge ${successRate >= 80 ? 'success' : successRate >= 50 ? 'warning' : 'danger'}">
                                ${successRate}%
                            </span>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            updateWeeklyChart() {
                const container = document.getElementById('weeklyChart');
                const last7Days = this.getLast7Days();

                let html = '';
                last7Days.forEach(day => {
                    const dayWalks = this.data.walks.filter(walk => walk.date === day.date);
                    const totalDistance = dayWalks.reduce((sum, walk) => sum + (walk.distance || 0), 0);
                    const height = Math.min(totalDistance * 30, 250); // Max height 250px

                    html += `
                        <div class="chart-bar" style="height: ${height}px;">
                            <div class="chart-label">${day.label}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            getLast7Days() {
                const days = [];
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    days.push({
                        date: date.toISOString().split('T')[0],
                        label: date.toLocaleDateString('de-DE', { weekday: 'short' })
                    });
                }
                return days;
            }

            showProfileForm() {
                if (this.data.profile) {
                    // Fill form with existing data
                    document.getElementById('dogName').value = this.data.profile.name || '';
                    document.getElementById('dogBreed').value = this.data.profile.breed || '';
                    document.getElementById('dogBirthDate').value = this.data.profile.birthDate || '';
                    document.getElementById('dogWeight').value = this.data.profile.weight || '';
                    document.getElementById('dogChip').value = this.data.profile.chipNumber || '';
                    document.getElementById('dogEnergy').value = this.data.profile.energyLevel || 3;
                    document.getElementById('dogAllergies').value = this.data.profile.allergies || '';
                    document.getElementById('dogBehavior').value = this.data.profile.behavior || '';
                }
                this.showModal('profileModal');
            }

            saveProfile(event) {
                event.preventDefault();

                this.data.profile = {
                    name: document.getElementById('dogName').value,
                    breed: document.getElementById('dogBreed').value,
                    birthDate: document.getElementById('dogBirthDate').value,
                    weight: parseFloat(document.getElementById('dogWeight').value) || 0,
                    chipNumber: document.getElementById('dogChip').value,
                    energyLevel: parseInt(document.getElementById('dogEnergy').value),
                    allergies: document.getElementById('dogAllergies').value,
                    behavior: document.getElementById('dogBehavior').value
                };

                this.saveData();
                this.updateProfile();
                this.closeModal('profileModal');
            }

            updateProfile() {
                const container = document.getElementById('profileContent');

                if (!this.data.profile || !this.data.profile.name) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üêï</div>
                            <p>Noch kein Hundeprofil erstellt</p>
                            <button class="btn" onclick="app.showProfileForm()">Profil erstellen</button>
                        </div>
                    `;
                    return;
                }

                const profile = this.data.profile;
                const age = profile.birthDate ? this.calculateAge(profile.birthDate) : 'Unbekannt';

                container.innerHTML = `
                    <div class="grid grid-2">
                        <div>
                            <h4>üêï ${profile.name}</h4>
                            <p><strong>Rasse:</strong> ${profile.breed || 'Unbekannt'}</p>
                            <p><strong>Alter:</strong> ${age}</p>
                            <p><strong>Gewicht:</strong> ${profile.weight || 0} kg</p>
                            <p><strong>Energielevel:</strong> ${'‚≠ê'.repeat(profile.energyLevel || 3)} (${profile.energyLevel || 3}/5)</p>
                        </div>
                        <div>
                            <p><strong>Chip-Nr:</strong> ${profile.chipNumber || 'Nicht erfasst'}</p>
                            <p><strong>Allergien:</strong> ${profile.allergies || 'Keine bekannt'}</p>
                            <p><strong>Verhalten:</strong> ${profile.behavior || 'Nicht erfasst'}</p>
                        </div>
                    </div>
                `;
            }

            calculateAge(birthDate) {
                const birth = new Date(birthDate);
                const today = new Date();
                const ageInMonths = (today.getFullYear() - birth.getFullYear()) * 12 +
                                   (today.getMonth() - birth.getMonth());

                if (ageInMonths < 12) {
                    return `${ageInMonths} Monate`;
                } else {
                    const years = Math.floor(ageInMonths / 12);
                    const months = ageInMonths % 12;
                    return months > 0 ? `${years} Jahre ${months} Monate` : `${years} Jahre`;
                }
            }

            showTrainingForm() {
                document.getElementById('trainingForm').reset();
                this.showModal('trainingModal');
            }

            saveTraining(event) {
                event.preventDefault();

                const training = {
                    id: Date.now().toString(),
                    trick: document.getElementById('trainingTrick').value,
                    difficulty: parseInt(document.getElementById('trainingDifficulty').value),
                    attempts: parseInt(document.getElementById('trainingAttempts').value),
                    successes: parseInt(document.getElementById('trainingSuccesses').value),
                    lastPracticed: new Date().toISOString().split('T')[0],
                    notes: document.getElementById('trainingNotes').value
                };

                this.data.training.push(training);
                this.saveData();
                this.updateTrainingList();
                this.closeModal('trainingModal');
            }

            updateTrainingList() {
                const container = document.getElementById('trainingList');

                if (this.data.training.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéØ</div>
                            <p>Noch keine Trainings erfasst</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                this.data.training.forEach(training => {
                    const successRate = Math.round((training.successes / training.attempts) * 100);
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>${training.trick}</strong><br>
                                <small>Schwierigkeit: ${'‚≠ê'.repeat(training.difficulty)}</small><br>
                                <small>Letzte √úbung: ${training.lastPracticed}</small><br>
                                <small>${training.successes}/${training.attempts} erfolgreich</small>
                                ${training.notes ? `<br><small style="color: var(--text-secondary);">${training.notes}</small>` : ''}
                            </div>
                            <div style="text-align: center;">
                                <span class="badge ${successRate >= 80 ? 'success' : successRate >= 50 ? 'warning' : 'danger'}">
                                    ${successRate}%
                                </span>
                                <br><br>
                                <button class="btn btn-danger" onclick="app.deleteTraining('${training.id}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">üóëÔ∏è</button>
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            deleteTraining(id) {
                if (confirm('Training wirklich l√∂schen?')) {
                    this.data.training = this.data.training.filter(t => t.id !== id);
                    this.saveData();
                    this.updateTrainingList();
                    this.updateDashboard();
                }
            }

            showFeedingForm() {
                document.getElementById('feedingForm').reset();
                document.getElementById('feedingTime').value = new Date().toTimeString().slice(0, 5);
                this.showModal('feedingModal');
            }

            saveFeeding(event) {
                event.preventDefault();

                const feeding = {
                    id: Date.now().toString(),
                    date: new Date().toISOString().split('T')[0],
                    time: document.getElementById('feedingTime').value,
                    foodType: document.getElementById('feedingType').value,
                    amount: parseFloat(document.getElementById('feedingAmount').value) || 0,
                    water: parseFloat(document.getElementById('feedingWater').value) || 0
                };

                this.data.feeding.push(feeding);
                this.saveData();
                this.updateFeedingList();
                this.updateDashboard();
                this.closeModal('feedingModal');
            }

            updateFeedingList() {
                const container = document.getElementById('feedingList');

                if (this.data.feeding.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">üçΩÔ∏è</div>
                            <p>Noch keine F√ºtterungen erfasst</p>
                        </div>
                    `;
                    return;
                }

                // Group by date
                const groupedFeeding = {};
                this.data.feeding.forEach(feed => {
                    if (!groupedFeeding[feed.date]) {
                        groupedFeeding[feed.date] = [];
                    }
                    groupedFeeding[feed.date].push(feed);
                });

                let html = '';
                Object.keys(groupedFeeding).sort().reverse().slice(0, 7).forEach(date => {
                    const feeds = groupedFeeding[date];
                    const totalAmount = feeds.reduce((sum, feed) => sum + feed.amount, 0);
                    const totalWater = feeds.reduce((sum, feed) => sum + feed.water, 0);

                    html += `
                        <div class="card" style="margin-bottom: 1rem;">
                            <h4>${new Date(date).toLocaleDateString('de-DE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</h4>
                            <p><strong>Gesamt:</strong> ${totalAmount}g Futter, ${totalWater}ml Wasser</p>
                            <div style="margin-top: 1rem;">
                                ${feeds.map(feed => `
                                    <div class="list-item">
                                        <div>
                                            <strong>${this.getFoodTypeIcon(feed.foodType)} ${feed.foodType}</strong><br>
                                            <small>${feed.time} - ${feed.amount}g${feed.water > 0 ? ` + ${feed.water}ml Wasser` : ''}</small>
                                        </div>
                                        <button class="btn btn-danger" onclick="app.deleteFeeding('${feed.id}')" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">üóëÔ∏è</button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            getFoodTypeIcon(type) {
                const icons = {
                    'trockenfutter': 'ü•ò',
                    'nassfutter': 'üçñ',
                    'leckerlis': 'üç™',
                    'knochen': 'ü¶¥'
                };
                return icons[type] || 'üçΩÔ∏è';
            }

            deleteFeeding(id) {
                if (confirm('F√ºtterung wirklich l√∂schen?')) {
                    this.data.feeding = this.data.feeding.filter(f => f.id !== id);
                    this.saveData();
                    this.updateFeedingList();
                    this.updateDashboard();
                }
            }

            updateStats() {
                // Activity Chart
                this.renderActivityChart();
                this.renderTrainingChart();
                this.renderDetailStats();
            }

            renderActivityChart() {
                const container = document.getElementById('activityChart');
                const last30Days = this.getLast30Days();

                let html = '';
                last30Days.forEach(day => {
                    const dayWalks = this.data.walks.filter(walk => walk.date === day.date);
                    const totalDistance = dayWalks.reduce((sum, walk) => sum + (walk.distance || 0), 0);
                    const height = Math.min(totalDistance * 20, 250);

                    html += `
                        <div class="chart-bar" style="height: ${height}px;">
                            <div class="chart-label">${day.day}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            renderTrainingChart() {
                const container = document.getElementById('trainingChart');

                if (this.data.training.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>Keine Trainingsdaten</p></div>';
                    return;
                }

                // Group by trick
                const trickStats = {};
                this.data.training.forEach(training => {
                    if (!trickStats[training.trick]) {
                        trickStats[training.trick] = { attempts: 0, successes: 0 };
                    }
                    trickStats[training.trick].attempts += training.attempts;
                    trickStats[training.trick].successes += training.successes;
                });

                let html = '';
                Object.keys(trickStats).slice(0, 10).forEach(trick => {
                    const stats = trickStats[trick];
                    const successRate = (stats.successes / stats.attempts) * 100;
                    const height = (successRate / 100) * 250;

                    html += `
                        <div class="chart-bar" style="height: ${height}px;">
                            <div class="chart-label">${trick.slice(0, 8)}</div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            renderDetailStats() {
                const container = document.getElementById('detailStats');

                const totalWalks = this.data.walks.length;
                const totalDistance = this.data.walks.reduce((sum, walk) => sum + (walk.distance || 0), 0);
                const totalTime = this.data.walks.reduce((sum, walk) => sum + (walk.duration || 0), 0);
                const avgDistance = totalWalks > 0 ? (totalDistance / totalWalks).toFixed(1) : 0;
                const avgTime = totalWalks > 0 ? Math.round((totalTime / totalWalks) / 60) : 0;

                const totalTraining = this.data.training.length;
                const totalAttempts = this.data.training.reduce((sum, t) => sum + t.attempts, 0);
                const totalSuccesses = this.data.training.reduce((sum, t) => sum + t.successes, 0);
                const overallSuccessRate = totalAttempts > 0 ? Math.round((totalSuccesses / totalAttempts) * 100) : 0;

                container.innerHTML = `
                    <div class="grid grid-2">
                        <div>
                            <h4>üö∂ Spaziergang-Statistiken</h4>
                            <p><strong>Durchschnittliche Distanz:</strong> ${avgDistance} km</p>
                            <p><strong>Durchschnittliche Dauer:</strong> ${avgTime} min</p>
                            <p><strong>L√§ngster Spaziergang:</strong> ${Math.max(...this.data.walks.map(w => w.distance || 0)).toFixed(1)} km</p>
                            <p><strong>Gesamtzeit aktiv:</strong> ${Math.round(totalTime / 3600)} Stunden</p>
                        </div>
                        <div>
                            <h4>üéØ Training-Statistiken</h4>
                            <p><strong>Gesamt-Erfolgsrate:</strong> ${overallSuccessRate}%</p>
                            <p><strong>Verschiedene Tricks:</strong> ${new Set(this.data.training.map(t => t.trick)).size}</p>
                            <p><strong>Gesamte Versuche:</strong> ${totalAttempts}</p>
                            <p><strong>Erfolgreiche Versuche:</strong> ${totalSuccesses}</p>
                        </div>
                    </div>
                `;
            }

            getLast30Days() {
                const days = [];
                for (let i = 29; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    days.push({
                        date: date.toISOString().split('T')[0],
                        day: date.getDate()
                    });
                }
                return days;
            }

            exportData() {
                try {
                    // Create CSV content
                    let csvContent = "data:text/csv;charset=utf-8,";

                    // Export walks
                    csvContent += "SPAZIERG√ÑNGE\n";
                    csvContent += "Datum,Startzeit,Endzeit,Dauer(min),Distanz(km),Wetter,Notizen\n";
                    this.data.walks.forEach(walk => {
                        csvContent += `${walk.date},${walk.startTime},${walk.endTime || ''},${Math.round((walk.duration || 0) / 60)},${walk.distance || 0},${walk.weather || ''},${(walk.notes || '').replace(/,/g, ';')}\n`;
                    });

                    csvContent += "\nTRAINING\n";
                    csvContent += "Datum,Trick,Schwierigkeit,Versuche,Erfolge,Erfolgsrate(%),Notizen\n";
                    this.data.training.forEach(training => {
                        const successRate = Math.round((training.successes / training.attempts) * 100);
                        csvContent += `${training.lastPracticed},${training.trick},${training.difficulty},${training.attempts},${training.successes},${successRate},${(training.notes || '').replace(/,/g, ';')}\n`;
                    });

                    csvContent += "\nF√úTTERUNG\n";
                    csvContent += "Datum,Zeit,Typ,Menge(g),Wasser(ml)\n";
                    this.data.feeding.forEach(feed => {
                        csvContent += `${feed.date},${feed.time},${feed.foodType},${feed.amount},${feed.water}\n`;
                    });

                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement("a");
                    link.setAttribute("href", encodedUri);
                    link.setAttribute("download", `hundegassi_export_${new Date().toISOString().split('T')[0]}.csv`);
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);

                    alert('Daten erfolgreich exportiert!');
                } catch (error) {
                    console.error('Export-Fehler:', error);
                    alert('Fehler beim Exportieren der Daten!');
                }
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;

                        if (file.name.endsWith('.json')) {
                            const imported = JSON.parse(content);
                            this.data = { ...this.data, ...imported };
                        } else if (file.name.endsWith('.csv')) {
                            // Simple CSV import (basic implementation)
                            alert('CSV-Import ist in dieser Version vereinfacht. F√ºr vollst√§ndigen Import nutzen Sie JSON-Export.');
                        }

                        this.saveData();
                        this.updateDashboard();
                        this.updateProfile();
                        alert('Daten erfolgreich importiert!');

                    } catch (error) {
                        console.error('Import-Fehler:', error);
                        alert('Fehler beim Importieren der Daten!');
                    }
                };

                reader.readAsText(file);
                event.target.value = ''; // Reset file input
            }

            clearAllData() {
                if (confirm('Wirklich ALLE Daten l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!')) {
                    if (confirm('Sind Sie sicher? Alle Spazierg√§nge, Trainings und Profile werden gel√∂scht!')) {
                        localStorage.removeItem('hundegassi_data');
                        this.data = {
                            profile: null,
                            walks: [],
                            training: [],
                            feeding: [],
                            settings: {
                                theme: 'light',
                                defaultWeather: 'sonnig',
                                notifications: false
                            }
                        };
                        this.updateDashboard();
                        this.updateProfile();
                        alert('Alle Daten wurden gel√∂scht!');
                    }
                }
            }

            showModal(modalId) {
                document.getElementById(modalId).classList.add('show');
            }

            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('show');
            }

            formatDuration(seconds) {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                const secs = seconds % 60;

                if (hours > 0) {
                    return `${hours}h ${minutes}m`;
                } else {
                    return `${minutes}m ${secs}s`;
                }
            }
        }

        class WalkTracker {
            constructor() {
                this.isRunning = false;
                this.isPaused = false;
                this.startTime = null;
                this.pausedTime = 0;
                this.totalPausedTime = 0;
                this.interval = null;
                this.currentWalk = null;
                this.events = [];
            }

            start() {
                if (!this.isRunning) {
                    this.isRunning = true;
                    this.startTime = Date.now();
                    this.currentWalk = {
                        id: Date.now().toString(),
                        date: new Date().toISOString().split('T')[0],
                        startTime: new Date().toTimeString().slice(0, 5),
                        endTime: null,
                        duration: 0,
                        distance: 0,
                        weather: document.getElementById('currentWeather').value,
                        events: [],
                        notes: ''
                    };

                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('pauseBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = false;

                    this.interval = setInterval(() => this.updateTimer(), 1000);
                }
            }

            pause() {
                if (this.isRunning && !this.isPaused) {
                    this.isPaused = true;
                    this.pausedTime = Date.now();
                    clearInterval(this.interval);

                    document.getElementById('pauseBtn').textContent = '‚ñ∂Ô∏è Weiter';
                } else if (this.isRunning && this.isPaused) {
                    this.isPaused = false;
                    this.totalPausedTime += Date.now() - this.pausedTime;
                    this.interval = setInterval(() => this.updateTimer(), 1000);

                    document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
                }
            }

            stop() {
                if (this.isRunning) {
                    this.isRunning = false;
                    this.isPaused = false;
                    clearInterval(this.interval);

                    const endTime = Date.now();
                    const totalTime = endTime - this.startTime - this.totalPausedTime;

                    this.currentWalk.endTime = new Date().toTimeString().slice(0, 5);
                    this.currentWalk.duration = Math.floor(totalTime / 1000);
                    this.currentWalk.distance = parseFloat(document.getElementById('currentDistance').value) || 0;
                    this.currentWalk.weather = document.getElementById('currentWeather').value;
                    this.currentWalk.events = [...this.events];

                    app.data.walks.push(this.currentWalk);
                    app.saveData();

                    // Reset
                    this.reset();
                    app.updateDashboard();

                    alert(`Spaziergang beendet!\nDauer: ${app.formatDuration(this.currentWalk.duration)}\nDistanz: ${this.currentWalk.distance} km`);
                }
            }

            reset() {
                this.startTime = null;
                this.pausedTime = 0;
                this.totalPausedTime = 0;
                this.currentWalk = null;
                this.events = [];

                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('pauseBtn').textContent = '‚è∏Ô∏è Pause';
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('timerDisplay').textContent = '00:00:00';
                document.getElementById('currentDistance').value = '0';
                document.getElementById('currentEvents').innerHTML = '';
            }

            updateTimer() {
                if (this.isRunning && !this.isPaused) {
                    const currentTime = Date.now();
                    const elapsed = currentTime - this.startTime - this.totalPausedTime;
                    const seconds = Math.floor(elapsed / 1000);

                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = seconds % 60;

                    document.getElementById('timerDisplay').textContent =
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                }
            }

            addEvent(type) {
                if (!this.isRunning) {
                    alert('Starten Sie zuerst einen Spaziergang!');
                    return;
                }

                const event = {
                    type: type,
                    time: new Date().toTimeString().slice(0, 5),
                    notes: ''
                };

                const notes = prompt(`Notizen zu "${this.getEventName(type)}":`);
                if (notes !== null) {
                    event.notes = notes;
                    this.events.push(event);
                    this.updateEventsDisplay();
                }
            }

            getEventName(type) {
                const names = {
                    'poop': 'Kot',
                    'pee': 'Urin',
                    'social': 'Sozialkontakt',
                    'training': 'Training'
                };
                return names[type] || type;
            }

            getEventIcon(type) {
                const icons = {
                    'poop': 'üí©',
                    'pee': 'üíß',
                    'social': 'üêï',
                    'training': 'üéØ'
                };
                return icons[type] || 'üìù';
            }

            updateEventsDisplay() {
                const container = document.getElementById('currentEvents');

                if (this.events.length === 0) {
                    container.innerHTML = '';
                    return;
                }

                let html = '<h4>Ereignisse:</h4>';
                this.events.forEach((event, index) => {
                    html += `
                        <div class="list-item">
                            <div>
                                <strong>${this.getEventIcon(event.type)} ${this.getEventName(event.type)}</strong><br>
                                <small>${event.time}${event.notes ? ` - ${event.notes}` : ''}</small>
                            </div>
                            <button class="btn btn-danger" onclick="app.tracker.removeEvent(${index})" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">üóëÔ∏è</button>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            removeEvent(index) {
                this.events.splice(index, 1);
                this.updateEventsDisplay();
            }
        }

        class Calendar {
            constructor() {
                this.currentDate = new Date();
            }

            render() {
                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                document.getElementById('calendarTitle').textContent =
                    new Date(year, month).toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });

                this.generateCalendarDays(year, month);
            }

            generateCalendarDays(year, month) {
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);

                // Start from Monday
                const dayOfWeek = firstDay.getDay();
                startDate.setDate(startDate.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));

                const grid = document.querySelector('.calendar-grid');
                const existingDays = grid.querySelectorAll('.calendar-day');
                existingDays.forEach(day => day.remove());

                for (let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);

                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    dayElement.textContent = date.getDate();

                    if (date.getMonth() !== month) {
                        dayElement.style.opacity = '0.3';
                    }

                    // Check for activities on this date
                    const dateString = date.toISOString().split('T')[0];
                    const hasWalks = app.data.walks.some(walk => walk.date === dateString);
                    const hasFeeding = app.data.feeding.some(feed => feed.date === dateString);
                    const hasTraining = app.data.training.some(training => training.lastPracticed === dateString);

                    if (hasWalks || hasFeeding || hasTraining) {
                        dayElement.classList.add('has-events');
                    }

                    // Today highlight
                    const today = new Date().toISOString().split('T')[0];
                    if (dateString === today) {
                        dayElement.style.background = 'var(--primary-color)';
                        dayElement.style.color = 'white';
                    }

                    dayElement.addEventListener('click', () => this.showDayDetails(dateString));
                    grid.appendChild(dayElement);
                }
            }

            showDayDetails(dateString) {
                const walks = app.data.walks.filter(walk => walk.date === dateString);
                const feeding = app.data.feeding.filter(feed => feed.date === dateString);
                const training = app.data.training.filter(t => t.lastPracticed === dateString);

                if (walks.length === 0 && feeding.length === 0 && training.length === 0) {
                    alert('Keine Aktivit√§ten an diesem Tag.');
                    return;
                }

                let details = `Aktivit√§ten am ${new Date(dateString).toLocaleDateString('de-DE')}:\n\n`;

                if (walks.length > 0) {
                    details += 'üö∂ Spazierg√§nge:\n';
                    walks.forEach(walk => {
                        details += `  ‚Ä¢ ${walk.startTime}-${walk.endTime}: ${walk.distance}km, ${app.formatDuration(walk.duration)}\n`;
                    });
                    details += '\n';
                }

                if (training.length > 0) {
                    details += 'üéØ Training:\n';
                    training.forEach(t => {
                        const successRate = Math.round((t.successes / t.attempts) * 100);
                        details += `  ‚Ä¢ ${t.trick}: ${successRate}% Erfolg\n`;
                    });
                    details += '\n';
                }

                if (feeding.length > 0) {
                    details += 'üçΩÔ∏è F√ºtterung:\n';
                    feeding.forEach(feed => {
                        details += `  ‚Ä¢ ${feed.time}: ${feed.amount}g ${feed.foodType}\n`;
                    });
                }

                alert(details);
            }

            prevMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                this.render();
            }

            nextMonth() {
                this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                this.render();
            }
        }

        // Initialize app
        const app = new HundegassiApp();

        // Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'hundegassi-v1';
                    const urlsToCache = ['/'];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;

                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.altKey) {
                switch (e.key) {
                    case '1': app.switchTab('dashboard'); break;
                    case '2': app.switchTab('profile'); break;
                    case '3': app.switchTab('tracker'); break;
                    case '4': app.switchTab('calendar'); break;
                    case '5': app.switchTab('training'); break;
                    case '6': app.switchTab('feeding'); break;
                    case '7': app.switchTab('stats'); break;
                    case '8': app.switchTab('settings'); break;
                }
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('show');
            }
        });
    </script>
</body>
</html>